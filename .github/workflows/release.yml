name: build and release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-desktop-releases:
    runs-on: ubuntu-latest

    steps:
      - name: checkout repository
        uses: actions/checkout@v4

      - name: get version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: create releases directory
        run: mkdir -p releases

      - name: build skill packages for claude desktop
        run: |
          # build le skill archon
          echo "ðŸ“¦ building archon skill..."
          cd skills/archon
          zip -r "../../releases/archon-v${{ steps.version.outputs.VERSION }}.zip" .
          cd ../..
          echo "âœ… created releases/archon-v${{ steps.version.outputs.VERSION }}.zip"

      - name: list generated files
        run: |
          echo "ðŸ“‹ generated releases:"
          ls -lh releases/

      - name: create github release
        uses: softprops/action-gh-release@v1
        with:
          files: releases/*.zip
          body: |
            ## ðŸŽ‰ vibe academy marketplace - version ${{ steps.version.outputs.VERSION }}

            ### installation

            #### pour claude code (marketplace)
            \`\`\`bash
            /plugin marketplace add ${{ github.repository }}
            /plugin install vibe-academy@vibe-academy-marketplace
            \`\`\`

            #### pour claude desktop (manual)
            tÃ©lÃ©chargez le skill .zip ci-dessous et uploadez via :
            **settings â†’ capabilities â†’ skills â†’ upload skill**

            ### contenu

            **agents (2):**
            - âœ… deep-search - recherche approfondie brightdata/brave
            - âœ… explore-codebase - exploration spÃ©cialisÃ©e codebase

            **commands (6):**
            - âœ… create-plan - plan d'implÃ©mentation complet
            - âœ… execute-plan - exÃ©cution avec task management
            - âœ… prompt-agent - crÃ©er/optimiser agents
            - âœ… prompt-command - crÃ©er/optimiser commands
            - âœ… start-session - initialiser session avec context
            - âœ… update-docs-command - mettre Ã  jour memory bank

            **skills (1):**
            - âœ… archon - knowledge base + project management via rest api

            ### changelog

            voir [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.md) pour les dÃ©tails.

            ---

            **note**: fonctionne avec ou sans dÃ©pendances (archon, brightdata optionnels)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
